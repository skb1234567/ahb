<!DOCTYPE html>

<html lang="en">

<head>

  <meta charset="UTF-8">

  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <title>Travel Agency Management System</title>

  <style>

    /* Global Styles */

    * {

      box-sizing: border-box;

      margin: 0;

      padding: 0;

    }

    

    body {

      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;

      line-height: 1.6;

      background-color: #f5f5f5;

      color: #333;

    }

    

    .container {

      max-width: 1200px;

      margin: 0 auto;

      padding: 20px;

    }

    

    /* Header Styles */

    header {

      background-color: #2c3e50;

      color: white;

      padding: 20px 0;

      text-align: center;

      margin-bottom: 30px;

      box-shadow: 0 2px 5px rgba(0,0,0,0.1);

    }

    

    header h1 {

      font-size: 2.2rem;

    }

    

    /* Card Styles */

    .card {

      background-color: white;

      border-radius: 8px;

      

      padding: 25px;

      margin-bottom: 30px;

    }

    

    /* Form Styles */

    .form-group {

      margin-bottom: 20px;

    }

    

    .form-group label {

      display: block;

      margin-bottom: 8px;

      font-weight: 600;

    }

    

    .form-group input,

    .form-group select {

      width: 100%;

      padding: 10px;

      border: 1px solid #ddd;

      border-radius: 4px;

      font-size: 16px;

    }

    

    .form-row {

      display: flex;

      gap: 20px;

    }

    

    .form-row .form-group {

      flex: 1;

    }

    

    /* Button Styles */

    .btn {

      display: inline-block;

      padding: 10px 20px;

      background-color: #3498db;

      color: white;

      border: none;

      border-radius: 4px;

      cursor: pointer;

      font-size: 16px;

      text-decoration: none;

      transition: background-color 0.3s;

    }

    

    .btn:hover {

      background-color: #2980b9;

    }

    

    .btn-success {

      background-color: #2ecc71;

    }

    

    .btn-success:hover {

      background-color: #27ae60;

    }

    

    .btn-danger {

      background-color: #e74c3c;

    }

    

    .btn-danger:hover {

      background-color: #c0392b;

    }

    

    .btn-whatsapp {

      background-color: #25D366;

    }

    

    .btn-whatsapp:hover {

      background-color: #128C7E;

    }

    

    /* Navigation Styles */

    .nav-tabs {

      display: flex;

      border-bottom: 1px solid #ddd;

      margin-bottom: 20px;

    }

    

    .nav-tab {

      padding: 10px 20px;

      cursor: pointer;

      border: 1px solid transparent;

      border-bottom: none;

      border-radius: 4px 4px 0 0;

      margin-right: 5px;

      background-color: #f8f9fa;

    }

    

    .nav-tab.active {

      background-color: white;

      border-color: #ddd;

      border-bottom-color: white;

      font-weight: bold;

    }

    

    /* Table Styles */

    table {

      width: 100%;

      border-collapse: collapse;

      margin-top: 20px;

      table-layout: none;

    }

    

    th, td {

      padding: 12px 15px;

      text-align: left;

      border-bottom: 1px solid #ddd;

      white-space: nowrap;

      overflow: hidden;

      text-overflow: ellipsis;

    }

    

    th {

      background-color: #f8f9fa;

      font-weight: 600;

    }

    

    tr:hover {

      background-color: #f5f5f5;

    }

    

    /* Search Results Table */

    .search-results-table {

      border-collapse: collapse;

      width: 100%;

      margin-top: 15px;

    }

    

    .search-results-table th {

      background-color: #2c3e50;

      color: white;

      padding: 10px;

      text-align: left;

      position: sticky;

      top: 0;

    }

    

    .search-results-table td {

      padding: 8px 10px;

      border-bottom: 1px solid #ddd;

    }

    

    .search-results-table tr:nth-child(even) {

      background-color: #f2f2f2;

    }

    

    .search-results-table tr:hover {

      background-color: #e6e6e6;

    }

    

    @media (max-width: 768px) {

      table {

        display: block;

        overflow-x: auto;

      }

    }

    

    /* Utility Classes */

    .text-center {

      text-align: center;

    }

    

    .mt-3 {

      margin-top: 15px;

    }

    

    .mb-3 {

      margin-bottom: 15px;

    }

    

    .d-none {

      display: none;

    }

    

    /* Popup Styles */

    .popup {

      position: fixed;

      top: 50%;

      left: 50%;

      transform: translate(-50%, -50%);

      padding: 20px 30px;

      background-color: #2ecc71;

      color: white;

      border-radius: 5px;

      box-shadow: 0 3px 10px rgba(0,0,0,0.2);

      z-index: 1000;

      animation: fadeInOut 4s forwards;

    }

    

    @keyframes fadeInOut {

      0% { opacity: 0; }

      10% { opacity: 1; }

      90% { opacity: 1; }

      100% { opacity: 0; }

    }

  </style>

</head>

<body>

 
  <!-- Main Content -->

  <main class="container">

    <!-- Login Section -->

    <section id="loginSection" class="card">

      <h2 class="text-center">Branch Login</h2>

      <form id="loginForm" onsubmit="handleLogin(event)">

        <div class="form-group">

          <label for="username">Username</label>

          <input type="text" id="username" required>

        </div>

        

        <div class="form-group">

          <label for="password">Password</label>

          <input type="password" id="password" required>

        </div>

        

        <div class="text-center">

          <button type="submit" class="btn btn-success">Login</button>

        </div>

      </form>

    </section>

    <!-- Branch Dashboard -->

    <section id="branchSection" class="card d-none">

      <h2>Welcome, <span id="branchName"></span></h2>

      

      <div class="nav-tabs">

        <div class="nav-tab active" onclick="showSection('form')">New Booking</div>

        <div class="nav-tab" onclick="showSection('search')">Search Records</div>

      </div>

    </section>

    <!-- Booking Form Section -->

    <section id="formSection" class="card d-none">

      <h3>New Booking Form</h3>

      

      <form id="travelForm" onsubmit="handleSubmit(event)">

        <div class="form-row">

          <div class="form-group">

            <label for="customerName">Customer Name</label>

            <input type="text" id="customerName" name="customerName" required>

          </div>

          

          <div class="form-group">

            <label for="mobileNumber">Mobile Number</label>

            <input type="text" id="mobileNumber" name="mobileNumber" required>

          </div>

        </div>

        

        <div class="form-row">

          <div class="form-group">

            <label for="pnr">PNR Number</label>

            <input type="text" id="pnr" name="pnr" required>

          </div>

          

          <div class="form-group">

            <label for="tripType">Trip Type</label>

            <select id="tripType" name="tripType" required>

              <option value="One Way">One Way</option>

              <option value="Return">Return</option>

            </select>

          </div>

        </div>

        

        <div class="form-group">

          <label for="travelDate">Travel Date</label>

          <input type="date" id="travelDate" name="travelDate" required>

        </div>

        

        <div class="form-row">

          <div class="form-group">

            <label for="costPrice">Cost Price (SAR)</label>

            <input type="number" id="costPrice" name="costPrice" oninput="calculateProfit()" required>

          </div>

          

          <div class="form-group">

            <label for="cashTaken">Cash Taken (SAR)</label>

            <input type="number" id="cashTaken" name="cashTaken" oninput="calculateProfit(); calculateBalance()" required>

          </div>

        </div>

        

        <div class="form-row">

          <div class="form-group">

            <label for="profit">Profit (SAR)</label>

            <input type="number" id="profit" name="profit" readonly>

          </div>

          

          <div class="form-group">

            <label for="receivedCash">Received Cash (SAR)</label>

            <input type="number" id="receivedCash" name="receivedCash" oninput="calculateBalance()" required>

          </div>

        </div>

        

        <div class="form-group">

          <label for="balance">Balance (SAR)</label>

          <input type="number" id="balance" name="balance" readonly>

        </div>

        

        <div class="text-center">

          <button type="submit" class="btn btn-success">Submit Booking</button>

        </div>

      </form>

      

      <div id="whatsappButtonContainer" class="text-center mt-3 d-none">

        <a id="whatsappLink" class="btn btn-whatsapp" target="_blank">

          <i class="fab fa-whatsapp"></i> Send WhatsApp Message

        </a>

      </div>

    </section>

    <!-- Search Section -->

    <section id="searchSection" class="card d-none">

      <h3>Search Records</h3>

      

      <form id="searchForm" onsubmit="event.preventDefault(); searchRecord();">

        <div class="form-row">

          <div class="form-group">

            <label for="searchQuery">Search by Mobile or PNR</label>

            <input type="text" id="searchQuery" required>

          </div>

        </div>

        

        <div class="text-center">

          <button type="submit" class="btn">Search</button>

        </div>

      </form>

      

      <div id="searchResult" class="mt-3"></div>

    </section>

  </main>

  <!-- Popup Notification -->

  <div id="popupMessage" class="popup d-none"></div>

  <script>

    const scriptURL = "https://script.google.com/macros/s/AKfycbx1OULfRXdLoAux8EEVXQF9xXhM83dnG6sSwkxjbsYqXoqhZmBN_NFoV4F5hu87zzPP/exec";

    const branchData = {

      "Muhammad Shahzad": { password: "1234", branchName: "Muhammad Shahzad" },

      "Muhammad Madni": { password: "5678", branchName: "Muhammad Madni" },

      "Rana Usman": { password: "91011", branchName: "Rana Usman" },

      "Muhammad Tahir": { password: "1213", branchName: "Muhammad Tahir" }

    };

    let currentBranch = "";

    function handleLogin(event) {

      event.preventDefault();

      const username = document.getElementById("username").value;

      const password = document.getElementById("password").value;

      if (branchData[username] && branchData[username].password === password) {

        currentBranch = branchData[username].branchName;

        document.getElementById("branchName").innerText = currentBranch;

        document.getElementById("loginSection").classList.add("d-none");

        document.getElementById("branchSection").classList.remove("d-none");

        document.getElementById("formSection").classList.remove("d-none");

        

        // Set active tab

        document.querySelectorAll(".nav-tab").forEach(tab => tab.classList.remove("active"));

        document.querySelector(".nav-tab").classList.add("active");

      } else {

        alert("Incorrect username or password");

      }

    }

    function calculateProfit() {

      const costPrice = parseFloat(document.getElementById("costPrice").value) || 0;

      const cashTaken = parseFloat(document.getElementById("cashTaken").value) || 0;

      document.getElementById("profit").value = cashTaken - costPrice;

    }

    function calculateBalance() {

      const receivedCash = parseFloat(document.getElementById("receivedCash").value) || 0;

      const cashTaken = parseFloat(document.getElementById("cashTaken").value) || 0;

      document.getElementById("balance").value = receivedCash - cashTaken;

    }

    function handleSubmit(event) {

      event.preventDefault();

      const form = document.getElementById("travelForm");

      const formData = new FormData(form);

      formData.set("branch", currentBranch);

      const mobileNumberRaw = formData.get("mobileNumber").replace(/\D/g, '');

      const customerName = formData.get("customerName");

      const message = `

Customer Name: ${customerName}

Mobile Number: ${mobileNumberRaw}

PNR: ${formData.get("pnr")}

Trip Type: ${formData.get("tripType")}

Travel Date: ${formData.get("travelDate")}

Cost Price: ${formData.get("costPrice")}

Cash Taken: ${formData.get("cashTaken")}

Received Cash: ${formData.get("receivedCash")}

Balance: ${formData.get("balance")}

Branch: ${currentBranch}

`.trim();

      const countryCode = mobileNumberRaw.startsWith("05") ? "966" : "92";

      const fullMobile = `${countryCode}${mobileNumberRaw}`;

      const whatsappLink = `https://wa.me/${fullMobile}?text=${encodeURIComponent(message)}`;

      document.getElementById("whatsappLink").href = whatsappLink;

      document.getElementById("whatsappButtonContainer").classList.remove("d-none");

      fetch(scriptURL, {

        method: "POST",

        body: formData

      })

        .then(res => res.text())

        .then(data => {

          showPopup("Form submitted successfully");

          form.reset();

        })

        .catch(err => {

          alert("Error submitting form");

          console.error(err);

        });

    }

    function showPopup(message) {

      const popup = document.getElementById("popupMessage");

      popup.innerText = message;

      popup.classList.remove("d-none");

      setTimeout(() => {

        popup.classList.add("d-none");

      }, 4000);

    }

    function showSection(section) {

      document.getElementById("formSection").classList.toggle("d-none", section !== "form");

      document.getElementById("searchSection").classList.toggle("d-none", section !== "search");

      

      // Update active tab

      document.querySelectorAll(".nav-tab").forEach(tab => tab.classList.remove("active"));

      document.querySelectorAll(".nav-tab")[section === "form" ? 0 : 1].classList.add("active");

    }

    function searchRecord() {

      const query = document.getElementById("searchQuery").value.trim();

      if (!query) return;

      fetch(`${scriptURL}?search=${encodeURIComponent(query)}&branch=${encodeURIComponent(currentBranch)}`)

        .then(res => res.json())

        .then(data => {

          const resultDiv = document.getElementById("searchResult");

          if (data.length === 0) {

            resultDiv.innerHTML = "<p>No record found.</p>";

            return;

          }

          // Create a more robust table structure

          let html = `

            <div style="overflow-x:auto;">

              <h4>Search Result:</h4>

              <table class="search-results-table">

                <thead>

                  <tr>

          `;

          

          // Add headers

          Object.keys(data[0]).forEach(key => {

            html += `<th>${key.replace(/([A-Z])/g, ' $1').trim()}</th>`;

          });

          

          html += `

                </tr>

              </thead>

              <tbody>

          `;

          

          // Add rows

          data.forEach(row => {

            html += "<tr>";

            Object.values(row).forEach(val => {

              html += `<td>${val || ''}</td>`;

            });

            html += "</tr>";

          });

          html += `

                </tbody>

              </table>

            </div>

          `;

          

          resultDiv.innerHTML = html;

        })

        .catch(err => {

          console.error("Search error:", err);

          document.getElementById("searchResult").innerHTML = `

            <p>Error loading results. Please try again.</p>

            ${err.message ? `<small>${err.message}</small>` : ''}

          `;

        });

    }

  </script>

</body>

</html>
